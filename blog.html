<!DOCTYPE html>
<html lang="en" class="scroll-smooth">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tyler Egloff | Blog</title>
    <link
        href="data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwbGgscGxoLHBsaCxwbGgsAAAD/AAAA/wAAAP8AAAD/HBsaCxwbGgscGxoLHBsaCxwbGgscGxoLAAAAAAAAAAAcGxoLHBsaCwAAAP8AAAD/o1Uq/6NVKv+jVSr/o1Uq/wAAAP8AAAD/HBsaCxwbGgscGxoLHBsaCwAAAAAcGxoLHBsaCwAAAP8Os63/DrOt/6NVKv+jVSr/FIeD/w6zrf8Os63/o1Uq/wAAAP8cGxoLHBsaCxwbGgscGxoLHBsaCwAAAP8nj4v/qG5N/6huTf+jVSr/o1Uq/w6zrf8Os63/FIeD/6NVKv+jVSr/AAAA/xwbGgscGxoLHBsaCxwbGgsKDQ3/J4+L/9mcav/jhE//44RP/+OET/8Os63/DrOt/xSHg/8Uh4P/o1Uq/wAAAP8cGxoLHBsaCwAAAP/6jxv/44RP/9mcav9Bv7v/P8zH/yePi/8Uh4P/DrOt/w6zrf8Uh4P/FIeD/6NVKv8AAAD/HBsaCxwbGgsAAAD/+o8b/+OET//jhE//P8zH/z/Mx/8Uh4P/w6zrf8Os63/FIeD/xSHg/8Uh4P/AAAA/xwbGgscGxoLAAAA//qPG//jhE//44RP/+OET/9Vq6j/Vauo/xSHg/8Os63/DrOt/xSHg/8Uh4P/o1Uq/wAAAP8cGxoLHBsaCwAAAAAAAAD/+o8b/+OET//jhE//P8zH/z/Mx//jhE//44RP/+OET//jhE//FIeD/wAAAP8cGxoLHBsaCxwbGgscGxoLAAAA//qPG//ZnGr/44RP/+OET/8Uh4P/44RP/+OET//jhE//DrOt/xSHg/8AAAD/HBsaCwAAAAAAAAAAHBsaCxwbGv/6jxv/2Zxq/+OET//jhE//FIeD/+OET//ZnGr/DrOt/w6zrf8Os63/AAAA/xwbGgsAAAAAAAAAABwbGgscGxoLHBsa//qPG//jhE//44RP/+OET/9Vq6j/Vauo/w6zrf8Os63/AAAA/xwbGgscGxoLAAAAAAAAAAAAAAAAHBsaCxwbGgscGxr/AAAA/+OET//jhE//P8zH/z/Mx/8AAAD/HBsa/xwbGgscGxoLAAAAAAAAAAAAAAAAAAAAAAAAAAAcGxoLHBsaCxwbGgscGxr/AAAA/wAAAP8AAAD/HBsa/xwbGgsAAAAAAAAAAAAAAAAAAAAA/D8AAPAPAADgBwAAwAMAAMADAACAAQAAgAEAAIABAACAAQAAgAEAAMADAADAAwAAwAMAAOAHAADwDwAA/B8AAA=="
        rel="icon" type="image/x-icon">
    <script src="https://cdn.tailwindcss.com?plugins=typography"></script>
    <style>
        /* Typography customizations */
        .prose h3 { margin-top: 0.25em; margin-bottom: 0.1em; }
        .prose h5 { margin-top: 0.1em; margin-bottom: 0.1em; font-weight: 600; }
        .prose p { margin-top: 0.1em; margin-bottom: 0.5em; }
        .prose a { color: #818cf8; }
        .prose a:hover { color: #a5b4fc; }
        .prose ul { margin-top: 0; margin-bottom: 0; }
        .prose ol { margin-top: 0; margin-bottom: 0; }
        .prose li { margin-top: 0; margin-bottom: 0; }
        .prose > div[style*="flex"] {
            max-width: 100%;
            overflow-x: auto;
        }
        .prose table { 
            margin-top: 0.5em; 
            margin-bottom: 0.5em;
            border-collapse: separate;
            border-spacing: 0;
            border: 1px solid #374151;
            border-radius: 0.5rem;
            overflow: hidden;
            min-width: 0;
        }
        .prose td, .prose th {
            word-wrap: break-word;
            overflow-wrap: break-word;
        }
        .prose th {
            background: rgba(55, 65, 81, 0.7);
            padding: 0.5rem 1rem;
            text-align: left;
            font-weight: 600;
            border-bottom: 1px solid #4b5563;
        }
        .prose th[colspan] {
            background: rgba(75, 85, 99, 0.5);
        }
        .prose td, .prose th:not([colspan]) {
            border-right: 1px solid #4b5563;
            width: 50%;
        }
        .prose td:last-child, .prose th:last-child {
            border-right: none;
        }
        .prose td {
            padding: 0.5rem 1rem;
            border-bottom: 1px solid #374151;
            background: rgba(31, 41, 55, 0.5);
        }
        .prose tr:last-child td {
            border-bottom: none;
        }
        .prose tbody tr:nth-child(even) td {
            background: rgba(55, 65, 81, 0.3);
        }
        /* Animation for mobile menu dropdown */
        .slide-down {
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                transform: translateY(-1rem);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        /* Scroll margin to account for header size */
        section {
            scroll-margin-top: 8rem;
        }

        /* Purple card border glow on hover */
        .card-glow {
            position: relative;
            overflow: hidden;
            border-radius: 1rem;
            transition: transform 0.5s cubic-bezier(1, 0, 0, 1), box-shadow 0.5s;
        }

        .card-glow:hover {
            box-shadow: 0 0 6px 2px rgba(41, 5, 173, 0.2), 0 0 0 2px rgba(41, 5, 173, 0.05);
        }

        .card-glow:hover::before {
            opacity: 1;
            transform: rotate(-45deg) translateY(120%);
        }
    </style>
</head>

<body class="bg-gray-900 text-gray-100 min-h-screen"
    style="background-image: url('data:image/svg+xml;utf8,<svg width=\'400\' height=\'400\' viewBox=\'0 0 400 400\' fill=\'none\' xmlns=\'http://www.w3.org/2000/svg\'><circle cx=\'50\' cy=\'80\' r=\'1.5\' fill=\'white\' opacity=\'0.25\'/><circle cx=\'120\' cy=\'200\' r=\'2.5\' fill=\'white\' opacity=\'0.4\'/><circle cx=\'300\' cy=\'100\' r=\'1\' fill=\'white\' opacity=\'0.3\'/><circle cx=\'350\' cy=\'350\' r=\'3\' fill=\'white\' opacity=\'0.25\'/><circle cx=\'200\' cy=\'300\' r=\'2\' fill=\'white\' opacity=\'0.2\'/><circle cx=\'370\' cy=\'40\' r=\'1.2\' fill=\'white\' opacity=\'0.3\'/><circle cx=\'60\' cy=\'350\' r=\'2\' fill=\'white\' opacity=\'0.25\'/><circle cx=\'250\' cy=\'250\' r=\'1.7\' fill=\'white\' opacity=\'0.35\'/><circle cx=\'180\' cy=\'60\' r=\'1.3\' fill=\'white\' opacity=\'0.25\'/></svg>'); background-size: 400px 400px;">
    <header class="fixed w-full top-0 left-0 z-50 backdrop-blur-sm bg-gray-900/80 border-b border-gray-800">
        <div class="max-w-6xl mx-auto px-8">
            <div class="flex justify-center items-center h-16 relative">
                <!-- Desktop Nav -->
                <nav class="hidden md:flex space-x-8">
                    <a href="index.html#home" class="hover:text-indigo-400 transition">HOME</a>
                    <a href="index.html#projects" class="hover:text-indigo-400 transition">PROJECTS</a>
                    <a href="index.html#publications" class="hover:text-indigo-400 transition">PUBLICATIONS</a>
                    <a href="index.html#awards" class="hover:text-indigo-400 transition">AWARDS</a>
                    <a href="index.html#blog" class="hover:text-indigo-400 transition">BLOG</a>
                    <a href="index.html#contact" class="hover:text-indigo-400 transition">CONTACT</a>
                </nav>
                <!-- Mobile Nav Toggle -->
                <button id="menu-btn"
                    class="md:hidden absolute right-0 flex items-center justify-center w-10 h-10 rounded hover:bg-gray-800 transition z-50"
                    aria-label="Open menu">
                    <svg id="menu-icon" class="w-7 h-7 block" fill="none" stroke="currentColor" stroke-width="2"
                        viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16" />
                    </svg>
                    <svg id="close-icon" class="w-7 h-7 hidden" fill="none" stroke="currentColor" stroke-width="2"
                        viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
        </div>
        <!-- Mobile Nav -->
        <div id="mobile-menu"
            class="fixed top-0 left-0 w-full bg-gray-900/95 z-40 flex flex-col items-center pt-24 pb-8 space-y-6 text-lg font-medium shadow-lg slide-down transition-all duration-300 ease-in-out hidden">
            <a href="index.html#home" class="hover:text-indigo-400 transition" onclick="toggleMenu()">HOME</a>
            <a href="index.html#projects" class="hover:text-indigo-400 transition" onclick="toggleMenu()">PROJECTS</a>
            <a href="index.html#publications" class="hover:text-indigo-400 transition" onclick="toggleMenu()">PUBLICATIONS</a>
            <a href="index.html#awards" class="hover:text-indigo-400 transition" onclick="toggleMenu()">AWARDS</a>
            <a href="index.html#blog" class="hover:text-indigo-400 transition" onclick="toggleMenu()">BLOG</a>
            <a href="index.html#contact" class="hover:text-indigo-400 transition" onclick="toggleMenu()">CONTACT</a>
        </div>
    </header>

    <main class="max-w-6xl mx-auto px-4 pt-16 pb-6" id="blog-main">
        <section id="post" class="py-6 px-4 sm:px-6 relative">
            <div class="max-w-5xl mx-auto prose prose-invert prose-lg">
                <h1 id="post-title" class="text-6xl md:text-7xl font-extrabold mb-2 text-center">Blog Post</h1>
                <p id="post-subtitle" class="text-gray-400 text-lg md:text-xl text-center mb-6 hidden"></p>

                <!-- Table of Contents - left sidebar -->
                <nav id="toc" class="fixed left-0 top-16 h-[calc(100vh-4rem)] w-64 max-w-[85vw] bg-gray-900/95 backdrop-blur-sm border-r border-gray-700 z-40 transition-transform duration-300 overflow-visible" style="transform: translateX(-100%);">
                    <div class="p-4 h-full overflow-y-auto">
                        <h4 class="text-gray-400 uppercase text-xs font-semibold tracking-wider mb-2">Contents</h4>
                        <hr class="border-gray-600 mb-3">
                        <ul id="toc-list" class="flex flex-col gap-2 text-gray-300 text-sm">
                            <!-- Populated by JS -->
                        </ul>
                    </div>
                    <!-- Collapse button -->
                    <button id="toc-toggle" class="absolute -right-6 md:-right-8 top-4 w-6 md:w-8 h-16 md:h-20 bg-gray-800 border border-gray-700 border-l-0 rounded-r-lg flex flex-col items-center justify-center gap-0.5 hover:bg-gray-700 transition">
                        <svg id="toc-chevron" class="w-3 h-3 md:w-4 md:h-4 text-gray-400 transition-transform rotate-180" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                        </svg>
                        <span class="text-gray-400 text-[8px] md:text-[10px] font-semibold tracking-wider" style="writing-mode: vertical-rl;">INDEX</span>
                    </button>
                </nav>

                <article id="post-content" class="bg-gray-800 rounded-2xl shadow-lg p-8 max-w-3xl mx-auto">
                    <div id="post-byline" class="hidden">
                        <div class="flex justify-between items-center text-gray-300 text-base">
                            <span id="post-author"></span>
                            <span id="post-date"></span>
                        </div>
                        <hr class="border-gray-600 my-1">
                    </div>
                    <p class="text-gray-300">Loading post...</p>
                </article>

                <div id="back-link" class="mt-6 text-center">
                    <a href="index.html#blog" onclick="event.preventDefault(); if (document.referrer && document.referrer.includes(location.origin)) { history.back(); } else { location.href = 'index.html#blog'; }" class="text-indigo-400 hover:underline font-semibold">‚Üê Back</a>
                </div>
            </div>
        </section>

        <!-- Contact Section -->
        <section id="contact" class="py-8 px-4 sm:px-6">
            <h2 class="text-4xl font-bold text-center mb-4">
                <span class="bg-gradient-to-r from-indigo-400 to-purple-400 bg-clip-text text-transparent">Get in Touch
                    with me!</span>
            </h2>
            <div class="flex flex-col items-center mb-8">
                <a href="mailto:tyler.egloff@gmail.com"
                    class="flex items-center px-6 py-3 border-2 border-indigo-400 rounded-lg text-indigo-200 hover:bg-indigo-500 hover:text-white transition font-medium text-lg mb-4">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 mr-2" fill="none" viewBox="0 0 24 24"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M16 12l-4-4-4 4m8 0v6a2 2 0 01-2 2H6a2 2 0 01-2-2v-6m16-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v4" />
                    </svg>
                    Send me an email
                </a>
                <div class="flex justify-center space-x-4 mt-4">
                    <a href="https://www.linkedin.com/in/tyler-egloff/" class="hover:text-indigo-400">
                        <svg xmlns="http://www.w3.org/2000/svg" shape-rendering="geometricPrecision"
                            text-rendering="geometricPrecision" image-rendering="optimizeQuality" fill-rule="evenodd"
                            clip-rule="evenodd" viewBox="0 0 512 512" width="24" height="24" class="w-6 h-6">
                            <path fill="#fff"
                                d="M474.919 0H38.592C17.72 0 0 16.504 0 36.841V475.14C0 495.496 11.629 512 32.492 512h436.327C489.718 512 512 495.496 512 475.14V36.841C512 16.504 495.809 0 474.919 0zM195.043 195.043h68.928v35.136h.755c10.505-18.945 41.541-38.177 79.921-38.177 73.655 0 94.214 39.108 94.214 111.538v135.321h-73.148V316.883c0-32.427-12.947-60.883-43.227-60.883-36.768 0-54.295 24.889-54.295 65.758v117.103h-73.148V195.043zM73.139 438.861h73.148V195.043H73.139v243.818zm82.289-329.148c0 25.258-20.457 45.715-45.715 45.715-25.258 0-45.715-20.457-45.715-45.715 0-25.258 20.457-45.715 45.715-45.715 25.258 0 45.715 20.457 45.715 45.715z" />
                        </svg>
                    </a>
                    <a href="mailto:tyler.egloff@gmail.com" class="hover:text-indigo-400">
                        <svg xmlns="http://www.w3.org/2000/svg" shape-rendering="geometricPrecision"
                            text-rendering="geometricPrecision" image-rendering="optimizeQuality" fill-rule="evenodd"
                            clip-rule="evenodd" viewBox="0 0 512 327.53" width="24" height="24" class="w-6 h-6">
                            <path fill="#fff"
                                d="M254.41 274.97l100.93-100.92 153.49 153.48H0l153.49-153.48 100.92 100.92zM5.84 0l248.57 248.56L502.98 0H5.84zM0 290.3l131.77-131.78L0 26.75V290.3zm512 12.61L367.61 158.52 512 14.14v288.77z" />
                        </svg>
                    </a>
                    <a href="https://github.com/TylerEgloff" class="hover:text-indigo-400 flex items-center space-x-1">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 98 98" width="24" height="24"
                            class="w-6 h-6">
                            <path fill="#fff" fill-rule="evenodd"
                                d="M48.854 0C21.839 0 0 22 0 49.217c0 21.756 13.993 40.172 33.405 46.69 2.427.49 3.316-1.059 3.316-2.362 0-1.141-.08-5.052-.08-9.127-13.59 2.934-16.42-5.867-16.42-5.867-2.184-5.704-5.42-7.17-5.42-7.17-4.448-3.015.324-3.015.324-3.015 4.934.326 7.523 5.052 7.523 5.052 4.367 7.496 11.404 5.378 14.235 4.074.404-3.178 1.699-5.378 3.074-6.6-10.839-1.141-22.243-5.378-22.243-24.283 0-5.378 1.94-9.778 5.014-13.2-.485-1.222-2.184-6.275.486-13.038 0 0 4.125-1.304 13.426 5.052a46.97 46.97 0 0 1 12.214-1.63c4.125 0 8.33.571 12.213 1.63 9.302-6.356 13.427-5.052 13.427-5.052 2.67 6.763.97 11.816.485 13.038 3.155 3.422 5.015 7.822 5.015 13.2 0 18.905-11.404 23.06-22.324 24.283 1.78 1.548 3.316 4.481 3.316 9.126 0 6.6-.08 11.897-.08 13.526 0 1.304.89 2.853 3.316 2.364 19.412-6.52 33.405-24.935 33.405-46.691C97.707 22 75.788 0 48.854 0z"
                                clip-rule="evenodd" />
                        </svg>
                    </a>
                </div>
            </div>
        </section>
    </main>

    <!-- Shooting star container -->
    <div id="shooting-star-container" style="pointer-events:none; position:fixed; inset:0; z-index:10;"></div>

    <!-- Back to Top Arrow -->
    <button id="toTopBtn"
        class="hidden fixed bottom-8 right-8 z-50 bg-indigo-500 hover:bg-indigo-600 text-white rounded-full p-3 shadow-lg transition-opacity duration-300"
        aria-label="Back to top" onclick="window.scrollTo({ top: 0, behavior: 'smooth' });">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7" />
        </svg>
    </button>

    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <script>
        mermaid.initialize({
            startOnLoad: false,
            theme: 'dark',
            themeVariables: {
                primaryColor: '#6366f1',
                primaryTextColor: '#fff',
                primaryBorderColor: '#818cf8',
                lineColor: '#9ca3af',
                secondaryColor: '#374151',
                tertiaryColor: '#1f2937'
            }
        });
    </script>
    <script src="script.js"></script>
    <script>
        (function () {
            const params = new URLSearchParams(location.search);
            const postParam = params.get('post');
            const contentEl = document.getElementById('post-content');
            const titleEl = document.getElementById('post-title');
            const subtitleEl = document.getElementById('post-subtitle');
            const bylineEl = document.getElementById('post-byline');
            const authorEl = document.getElementById('post-author');
            const dateEl = document.getElementById('post-date');

            // Configure marked to preserve single-line breaks and use GFM
            if (window.marked && marked.setOptions) marked.setOptions({ gfm: true, breaks: true });

            if (!postParam) {
                contentEl.innerHTML = '<div class="p-6 text-gray-300">No post specified. Example: <a class="text-indigo-400 underline" href="blog.html?post=example.md">blog.html?post=example.md</a></div>';
                return;
            }

            const slug = postParam.endsWith('.md') ? postParam : postParam + '.md';
            const path = 'posts/' + slug;

            fetch(path).then(res => {
                if (!res.ok) throw new Error('Post not found');
                return res.text();
            }).then(md => {
                // Find and remove the first top-level heading (first line starting with '#') so title only appears once
                const lines = md.split(/\r?\n/);
                let titleLineIndex = -1;
                for (let i = 0; i < lines.length; i++) {
                    if (lines[i].trim().length && /^#{1,6}\s+/.test(lines[i].trim())) { titleLineIndex = i; break; }
                }
                if (titleLineIndex !== -1) {
                    const titleText = lines[titleLineIndex].replace(/^#{1,6}\s+/, '').trim();
                    if (titleText) titleEl.textContent = titleText;
                    // Remove that line and any immediately following empty line
                    lines.splice(titleLineIndex, 1);
                    if (lines[titleLineIndex] && lines[titleLineIndex].trim() === '') lines.splice(titleLineIndex, 1);
                }

                // Find and remove the subtitle (first ## heading)
                const subtitleIndex = lines.findIndex(l => l.trim().startsWith('## '));
                if (subtitleIndex !== -1) {
                    const subtitleText = lines[subtitleIndex].trim().slice(3).trim();
                    if (subtitleText) {
                        subtitleEl.textContent = subtitleText;
                        subtitleEl.classList.remove('hidden');
                    }
                    // Remove subtitle line and any immediately following empty line
                    lines.splice(subtitleIndex, 1);
                    if (lines[subtitleIndex] && lines[subtitleIndex].trim() === '') lines.splice(subtitleIndex, 1);
                }

                // Find and remove the byline (## Author | Date format)
                let bylineIndex = -1;
                for (let i = 0; i < lines.length; i++) {
                    if (lines[i].trim().length && /^##\s+/.test(lines[i].trim()) && lines[i].includes('|')) {
                        bylineIndex = i;
                        break;
                    }
                }
                if (bylineIndex !== -1) {
                    const bylineText = lines[bylineIndex].replace(/^##\s+/, '').trim();
                    const [author, date] = bylineText.split('|').map(s => s.trim());
                    if (author && date) {
                        authorEl.textContent = author;
                        dateEl.textContent = date;
                        bylineEl.classList.remove('hidden');
                    }
                    // Remove byline and any immediately following empty line
                    lines.splice(bylineIndex, 1);
                    if (lines[bylineIndex] && lines[bylineIndex].trim() === '') lines.splice(bylineIndex, 1);
                }

                const bodyMd = lines.join('\n');

                // Render markdown (with line-breaks preserved)
                if (window.marked) {
                    // Create a div for the markdown content (preserve byline)
                    const markdownDiv = document.createElement('div');
                    markdownDiv.className = 'prose prose-invert prose-indigo max-w-none';
                    markdownDiv.innerHTML = marked.parse(bodyMd);
                    // Clear loading text but keep byline
                    const loadingText = contentEl.querySelector('p.text-gray-300');
                    if (loadingText) loadingText.remove();
                    contentEl.appendChild(markdownDiv);

                    // Add IDs to headings for TOC navigation
                    const h3s = markdownDiv.querySelectorAll('h3');
                    h3s.forEach((h, i) => {
                        const slug = h.textContent.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/(^-|-$)/g, '');
                        h.id = slug || 'section-' + i;
                        h.style.scrollMarginTop = '4rem';
                    });

                    const h5s = markdownDiv.querySelectorAll('h5');
                    h5s.forEach((h, i) => {
                        const slug = h.textContent.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/(^-|-$)/g, '');
                        h.id = slug || 'subsection-' + i;
                        h.style.scrollMarginTop = '4rem';
                    });

                    // Build Table of Contents
                    const tocList = document.getElementById('toc-list');
                    const allHeadings = markdownDiv.querySelectorAll('h3, h5');
                    allHeadings.forEach(h => {
                        const li = document.createElement('li');
                        const a = document.createElement('a');
                        a.href = '#' + h.id;
                        a.textContent = h.textContent;
                        a.className = 'hover:text-indigo-400 transition block';
                        if (h.tagName === 'H5') {
                            li.className = 'pl-2 text-gray-400 border-gray-600 ml-2';
                        }
                        a.onclick = (e) => {
                            e.preventDefault();
                            h.scrollIntoView({ behavior: 'smooth', block: 'start' });
                        };
                        li.appendChild(a);
                        tocList.appendChild(li);
                    });

                    // TOC toggle functionality
                    const toc = document.getElementById('toc');
                    const tocToggle = document.getElementById('toc-toggle');
                    const tocChevron = document.getElementById('toc-chevron');
                    let tocCollapsed = true;
                    
                    tocToggle.addEventListener('click', (e) => {
                        e.stopPropagation();
                        tocCollapsed = !tocCollapsed;
                        if (tocCollapsed) {
                            toc.style.transform = 'translateX(-100%)';
                            tocChevron.style.transform = 'rotate(180deg)';
                        } else {
                            toc.style.transform = 'translateX(0)';
                            tocChevron.style.transform = 'rotate(0deg)';
                        }
                    });
                    
                    // Close TOC when clicking outside
                    document.addEventListener('click', (e) => {
                        if (!tocCollapsed && !toc.contains(e.target)) {
                            tocCollapsed = true;
                            toc.style.transform = 'translateX(-100%)';
                            tocChevron.style.transform = 'rotate(180deg)';
                        }
                    });

                    // Render Mermaid diagrams (supports responsive: "flowchart LR-TD" = LR on desktop, TD on mobile)
                    const mermaidBlocks = markdownDiv.querySelectorAll('code.language-mermaid');
                    const responsiveContainers = [];
                    
                    mermaidBlocks.forEach((block, i) => {
                        const pre = block.parentElement;
                        const code = block.textContent;
                        
                        // Check for responsive direction syntax: "flowchart LR-TD"
                        const responsiveMatch = code.match(/^flowchart\s+(LR|RL|TB|TD|BT)-(LR|RL|TB|TD|BT)/m);
                        
                        if (responsiveMatch) {
                            const [fullMatch, desktopDir, mobileDir] = responsiveMatch;
                            const wrapper = document.createElement('div');
                            
                            // Desktop version - render visible first, hide later
                            const desktopContainer = document.createElement('div');
                            desktopContainer.className = 'mermaid flex justify-center my-4';
                            desktopContainer.dataset.responsive = 'desktop';
                            desktopContainer.textContent = code.replace(fullMatch, 'flowchart ' + desktopDir);
                            
                            // Mobile version - render visible first, hide later
                            const mobileContainer = document.createElement('div');
                            mobileContainer.className = 'mermaid flex justify-center my-4';
                            mobileContainer.dataset.responsive = 'mobile';
                            mobileContainer.textContent = code.replace(fullMatch, 'flowchart ' + mobileDir);
                            
                            wrapper.appendChild(desktopContainer);
                            wrapper.appendChild(mobileContainer);
                            pre.replaceWith(wrapper);
                            
                            responsiveContainers.push(desktopContainer, mobileContainer);
                        } else {
                            const container = document.createElement('div');
                            container.className = 'mermaid flex justify-center my-4';
                            container.textContent = code;
                            pre.replaceWith(container);
                        }
                    });
                    
                    if (mermaidBlocks.length) {
                        mermaid.run().then(() => {
                            // Apply responsive visibility after render completes
                            responsiveContainers.forEach(c => {
                                if (c.dataset.responsive === 'desktop') {
                                    c.classList.add('hidden', 'md:flex');
                                } else {
                                    c.classList.add('md:hidden');
                                }
                            });
                        });
                    }
                    
                    // Auto-number figures (figcaptions inside <figure> elements)
                    const figcaptions = markdownDiv.querySelectorAll('figure > figcaption, [data-figure] > figcaption');
                    figcaptions.forEach((cap, i) => {
                        const num = i + 1;
                        cap.innerHTML = `<strong>Figure ${num}.</strong> ${cap.innerHTML}`;
                    });
                    
                    // Auto-number tables (captions or data-table-caption elements)
                    const tableCaptions = markdownDiv.querySelectorAll('[data-table] > caption, [data-table-caption]');
                    tableCaptions.forEach((cap, i) => {
                        const num = i + 1;
                        cap.innerHTML = `<strong>Table ${num}.</strong> ${cap.innerHTML}`;
                    });
                    
                    // Custom scroll visibility for back-to-top button on blog page
                    const toTopBtn = document.getElementById('toTopBtn');
                    
                    function updateToTopVisibility() {
                        if (!contentEl || !toTopBtn) return;
                        const contentRect = contentEl.getBoundingClientRect();
                        const contentBottomVisible = contentRect.bottom < window.innerHeight;
                        
                        toTopBtn.classList.toggle('hidden', !contentBottomVisible);
                    }
                    
                    window.addEventListener('scroll', updateToTopVisibility);
                    updateToTopVisibility();
                } else {
                    contentEl.textContent = bodyMd;
                }
            }).catch(err => {
                contentEl.innerHTML = '<div class="p-6 text-gray-300">Post not found: ' + path + '</div>';
            });
        })();
    </script>
</body>

</html>